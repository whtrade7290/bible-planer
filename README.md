# Bible Planer

성경 각 장의 글자 수를 기준으로 통독 일정을 균등하게 나눠 주는 간단한 REST API입니다. 절이나 단어 단위가 아니라 **장 단위로만 경계를 나눠** 하루 분량을 계산하기 때문에 실제 읽기 흐름이 끊기지 않는 것이 가장 큰 장점입니다. 예를 들어 긴 장이 중간에 잘려 나가는 대신 다른 장과 묶여 균형을 맞추므로 날짜별 분할이 훨씬 자연스럽습니다.

## 요구 사항
- Node.js 18+
- MySQL 데이터베이스(테이블 `bible2`에 `idx`, `long_label`, `chapter`, `book`, `countOfChapter` 칼럼 필요)

## 설치 및 실행
```bash
npm install
node index.js
```

`PORT` 변수를 지정하지 않으면 기본값은 `8080`입니다. 생성되는 CSV는 항상 루트의 `result/` 폴더에 저장되며 폴더가 없으면 서버가 자동으로 만들어 줍니다. 실행 중에 `result/` 폴더를 지웠더라도, 요청을 처리하기 전에 다시 생성하므로 따로 수동 작업이 필요 없습니다.

## 데이터베이스 접속 설정
루트 디렉터리에 `.env` 파일을 만들고 아래 값을 채워주세요.

```ini
DB_HOST=localhost
DB_USER=bible_user
DB_PASSWORD=secret
DB_NAME=bible
PORT=8080
```

서버는 `.env` 를 직접 읽어 환경 변수를 설정하므로 별도의 `dotenv` 설정이 필요 없습니다.

## API 사용법
- **GET `/bible`**: 사용법을 간단히 안내하는 문구를 돌려줍니다.
- **POST `/bible`**: 본 기능. JSON 본문에 `days` 값을 넣어 요청하면 요청 일수에 맞춰 `성경통독표(<일수>일).csv` 파일을 생성하고 곧바로 다운로드 응답으로 전송합니다. `days` 는 1 이상의 정수라면 모두 허용되며, 알고리즘은 해당 일수에 최대한 근접하도록 장 단위로 분할합니다. 나누기 불가능한 경우에는 500 에러로 실패 응답을 돌려줍니다.

### 요청 예시
Postman, Thunder Client 등에서 `http://localhost:8080/bible` 로 POST 요청을 보내고 Body 타입을 `raw` + `JSON` 으로 선택한 뒤 아래처럼 입력합니다.

```json
{
  "days": 150
}
```

또는 cURL을 사용해도 됩니다.

```bash
curl -X POST http://localhost:8080/bible \
  -H "Content-Type: application/json" \
  -d '{"days":365}' --output "성경통독표(365일).csv"
```

### 응답
- CSV 파일 제목 및 예시 헤더: `날짜, 성경(시작), 장(시작), 성경(끝), 장(끝), 글 수`
- CSV는 `result/` 폴더에 저장되며, 동일한 이름의 파일이 있으면 덮어씁니다.
- 글자 수 평균(`countOfChapter` 합계 ÷ `days`)을 기준으로 각 날짜 분량을 맞추되, **항상 장 단위로만 자르기 때문에** 실제 묶음이 조금씩 길거나 짧을 수 있습니다. 내부에서는 글자 수 허용 오차 범위를 조금씩 조정하면서 요청한 일수와 최대한 근접하게 맞춥니다.

## 참고
- DB 연결 실패나 CSV 생성 오류는 각각 500 응답으로 돌려주므로 로그를 확인하세요.
- 생성된 CSV 샘플(`성경통독표(100일).csv` 등)이 이미 저장소에 포함되어 있으니 결과 구조가 궁금하다면 열어보면 됩니다.
